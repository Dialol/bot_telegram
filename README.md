# Описание работы бота "Оператор-Бот-Клиент"

- **`1. Общая логика работы бота`**
Бот осуществляет связь между оператором и клиентом. Основная функциональность заключается в следующем:
* Оператор идентифицируется по Telegram ID и может отправлять запросы клиентам.
* Клиент не имеет доступа к функциям бота до тех пор, пока оператор не инициирует запрос (например, запрос на отправку паспорта).
* В дальнейшем можно добавить оповещение оператору, если клиент пытается связаться с ботом до запроса, или отправить клиенту уведомление, что нужно дождаться запроса от оператора.

- **`2. Рабочие кнопки`**
Бот включает несколько рабочих кнопок для взаимодействия:
* Запрос паспорта: оператор может запросить у клиента отправку фотографии паспорта.
* Отправка данных в базу: оператор может поочередно запросить у клиента информацию (например, полное имя, город, дата рождения).
* Дополнительно добавлены кнопки для демонстрации возможности запрашивать разные документы.
Все кнопки и запросы могут быть легко изменены под другие типы документов или данных.

- **`3. Логика взаимодействия с клиентом`**
После запроса от оператора, клиент может отправить одно сообщение в ответ, которое содержит либо фото паспорта, либо текст (текстовая отправка сейчас не нужна и может быть отключена). Фото будет получено оператором. В данный момент клиент имеет одну попытку отправить правильные данные. Если документ отправлен некорректно или нужен другой документ, эту логику нужно улучшить (см. раздел с багами).

- **`4. Переписка оператор-клиент (опционно)`**
Есть возможность добавить кнопку простой переписки между оператором и клиентом через бота с сохранением всех логов сообщений. Это может быть полезно для оперативного общения и отслеживания истории взаимодействий.

- **`5. Отправка данных оператора в базу`**
Работает функционал отправки данных клиента в базу данных по запросу оператора:
* После нажатия кнопки отправки данных, бот поочередно запрашивает у клиента:
    1. Полное имя,
    2. Город,
    3. Дата рождения.
Эти параметры могут быть изменены или дополнены при необходимости.

- **`6. Баги и проблемы`**
На данный момент наблюдаются проблемы со состояниями:
* Клиент имеет только одну попытку отправить данные. Если данные неверные или требуется другой документ, бот не обнуляет попытки при новом запросе.
* Нужно доработать логику, чтобы пользователь мог отправить другие данные или повторно отправить документ без необходимости перезапуска бота.
* Есть баг с функционалом отправки данных в базу: он работает только один раз, после чего логика прерывается.

## Структура проекта:

### `bot.py`
Основной файл программы. В этом файле создается экземпляр бота, настраивается диспетчер и подключаются обработчики. Запускается основной цикл обработки сообщений.

### `handlers`
Каталог, содержащий обработчики различных сообщений и действий бота. Разделяется на несколько файлов:

- **`main_handlers.py`**  
  Файл содержит основные обработчики для работы с кнопками и действиями в главном меню.

- **`callback_handlers.py`**  
  Файл с обработчиками коллбэк-запросов, которые отправляются в ответ на нажатия кнопок в инлайн-меню.

- **`state_handlers.py`**  
  Файл содержит обработчики, связанные с состояниями FSM. Обрабатывает ввод данных от пользователей и отправку сообщений оператору.

### `database.py`
Файл содержит настройки для работы с базой данных SQLAlchemy. Определяет структуру таблиц и функции для сохранения данных в базе.

### `config_reader.py`
Файл для чтения конфигурационных настроек из `.env` файла. Включает настройки для работы бота и другие параметры.

## Запуск:

Создайте в корневой папке проекта файл `.env` и добавьте туда токен вашего бота:
   ```env
   BOT_TOKEN = 'text'

Для взаимодействия от лица оператора добавьте его ID в config_reader.
